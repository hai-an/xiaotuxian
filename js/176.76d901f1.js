"use strict";(self["webpackChunkerabbit_pc_vue_project"]=self["webpackChunkerabbit_pc_vue_project"]||[]).push([[176],{500:function(e,a,o){o.r(a),o.d(a,{default:function(){return ge}});var l=o(3396),c=o(7139);const n=e=>((0,l.dD)("data-v-5d051116"),e=e(),(0,l.Cn)(),e),s={key:0,class:"container"},t=n((()=>(0,l._)("div",{class:"unbind"},[(0,l._)("div",{class:"loading"})],-1))),i=[t],r={key:1,class:"container"},d={class:"tab"},u=n((()=>(0,l._)("i",{class:"iconfont icon-bind"},null,-1))),m=n((()=>(0,l._)("span",null,"已有小兔鲜账号，请绑定手机",-1))),p=[u,m],v=n((()=>(0,l._)("i",{class:"iconfont icon-edit"},null,-1))),f=n((()=>(0,l._)("span",null,"没有小兔鲜账号，请完善资料",-1))),_=[v,f],k={key:0,class:"tab-content"},b={key:1,class:"tab-content"};function h(e,a,o,n,t,u){const m=(0,l.up)("LoginHeader"),v=(0,l.up)("CallbackBind"),f=(0,l.up)("CallbackPatch"),h=(0,l.up)("LoginFooter");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(m,null,{default:(0,l.w5)((()=>[(0,l.Uk)("联合登录")])),_:1}),n.isBind?((0,l.wg)(),(0,l.iD)("section",s,i)):((0,l.wg)(),(0,l.iD)("section",r,[(0,l._)("nav",d,[(0,l._)("a",{onClick:a[0]||(a[0]=e=>n.hasAccount=!0),class:(0,c.C_)({active:n.hasAccount}),href:"javascript:;"},p,2),(0,l._)("a",{onClick:a[1]||(a[1]=e=>n.hasAccount=!1),class:(0,c.C_)({active:!n.hasAccount}),href:"javascript:;"},_,2)]),n.hasAccount?((0,l.wg)(),(0,l.iD)("div",k,[(0,l.Wm)(v,{unionId:n.unionId,nickname:n.nickname,avatar:n.avatar},null,8,["unionId","nickname","avatar"])])):((0,l.wg)(),(0,l.iD)("div",b,[(0,l.Wm)(f,{unionId:n.unionId},null,8,["unionId"])]))])),(0,l.Wm)(h)],64)}o(7658);var w=o(4870),g=o(7442),y=o(2874);const C=e=>((0,l.dD)("data-v-43d2f317"),e=e(),(0,l.Cn)(),e),x={class:"user-info"},V=["src"],Z={class:"xtx-form-item"},I={class:"field"},D=C((()=>(0,l._)("i",{class:"icon iconfont icon-phone"},null,-1))),H={key:0,class:"error"},U={class:"xtx-form-item"},P={class:"field"},q=C((()=>(0,l._)("i",{class:"icon iconfont icon-code"},null,-1))),F={key:0,class:"error"};function j(e,a,o,n,s,t){const i=(0,l.up)("Field"),r=(0,l.up)("Form");return(0,l.wg)(),(0,l.j4)(r,{ref:"formCom","validation-schema":n.mySchema,autocomplete:"off",class:"xtx-form"},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",x,[(0,l._)("img",{src:n.avatar,alt:""},null,8,V),(0,l._)("p",null,"Hi，"+(0,c.zw)(n.nickname)+" 欢迎来小兔鲜，完成绑定后可以QQ账号一键登录哦~",1)]),(0,l._)("div",Z,[(0,l._)("div",I,[D,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.mobile},"input"]),modelValue:n.form.mobile,"onUpdate:modelValue":a[0]||(a[0]=e=>n.form.mobile=e),name:"mobile",type:"text",placeholder:"绑定的手机号"},null,8,["class","modelValue"])]),e.mobile?((0,l.wg)(),(0,l.iD)("div",H,(0,c.zw)(e.mobile),1)):(0,l.kq)("",!0)]),(0,l._)("div",U,[(0,l._)("div",P,[q,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.code},"input"]),modelValue:n.form.code,"onUpdate:modelValue":a[1]||(a[1]=e=>n.form.code=e),name:"code",type:"text",placeholder:"短信验证码"},null,8,["class","modelValue"]),(0,l._)("span",{onClick:a[2]||(a[2]=e=>n.send()),class:"code"},(0,c.zw)(0===n.time?"发送验证码":`${n.time}秒后发送`),1)]),e.code?((0,l.wg)(),(0,l.iD)("div",F,(0,c.zw)(e.code),1)):(0,l.kq)("",!0)]),(0,l._)("a",{onClick:a[3]||(a[3]=e=>n.submit()),href:"javascript:;",class:"submit"},"立即绑定")])),_:1},8,["validation-schema"])}var W=o(9716),z=o.n(W),A=o(5708),L=o(2025),Q=o(2900),S=o(3430),B=o(8391),R=o(65),E=o(2483),N={name:"CallbackBind",components:{Form:A.l0,Field:A.gN},props:{unionId:{type:String,default:""}},setup(e){const a=(0,w.iH)("null"),o=(0,w.iH)("null");z().Login.check()&&z().api("get_user_info").success((e=>{o.value=e.data.figureurl_qq_1,a.value=e.data.nickname}));const c=(0,w.qj)({mobile:null,code:null}),n={mobile:L.Z.mobile,code:L.Z.code},s=(0,w.iH)(null),t=(0,w.iH)(0),{pause:i,resume:r}=(0,S.Zv)((()=>{t.value--,t.value<=0&&i()}),1e3,!1);(0,l.Ah)((()=>{i()}));const d=async()=>{const e=n.mobile(c.mobile);!0===e?0===t.value&&(await(0,Q.Oq)(c.mobile),(0,B.Z)({type:"success",text:"发送成功"}),t.value=60,r()):s.value.setFieldError("mobile",e)},u=(0,R.oR)(),m=(0,E.tv)(),p=async()=>{const a=s.value.validate();a&&(0,Q.UA)({unionId:e.unionId,...c}).then((e=>{const{id:a,account:o,avatar:l,mobile:c,nickname:n,token:s}=e.result;u.commit("user/setUser",{id:a,account:o,avatar:l,mobile:c,nickname:n,token:s}),u.dispatch("cart/mergeLocalCart").then((()=>{m.push(u.state.user.redirectUrl),(0,B.Z)({type:"success",text:"QQ绑定成功"})}))})).catch((e=>{(0,B.Z)({type:"error",text:"绑定失败"})}))};return{nickname:a,avatar:o,form:c,mySchema:n,send:d,time:t,formCom:s,submit:p}}},$=o(89);const K=(0,$.Z)(N,[["render",j],["__scopeId","data-v-43d2f317"]]);var M=K;const O=e=>((0,l.dD)("data-v-23310c97"),e=e(),(0,l.Cn)(),e),Y={class:"xtx-form-item"},G={class:"field"},J=O((()=>(0,l._)("i",{class:"icon iconfont icon-user"},null,-1))),T={key:0,class:"error"},X={class:"xtx-form-item"},ee={class:"field"},ae=O((()=>(0,l._)("i",{class:"icon iconfont icon-phone"},null,-1))),oe={key:0,class:"error"},le={class:"xtx-form-item"},ce={class:"field"},ne=O((()=>(0,l._)("i",{class:"icon iconfont icon-code"},null,-1))),se={key:0,class:"error"},te={class:"xtx-form-item"},ie={class:"field"},re=O((()=>(0,l._)("i",{class:"icon iconfont icon-lock"},null,-1))),de={key:0,class:"error"},ue={class:"xtx-form-item"},me={class:"field"},pe=O((()=>(0,l._)("i",{class:"icon iconfont icon-lock"},null,-1))),ve={key:0,class:"error"};function fe(e,a,o,n,s,t){const i=(0,l.up)("Field"),r=(0,l.up)("Form");return(0,l.wg)(),(0,l.j4)(r,{ref:"formCom","validation-schema":n.mySchema,class:"xtx-form",autocomplete:"off"},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",Y,[(0,l._)("div",G,[J,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.account},"input"]),modelValue:n.form.account,"onUpdate:modelValue":a[0]||(a[0]=e=>n.form.account=e),name:"account",type:"text",placeholder:"请输入用户名"},null,8,["class","modelValue"])]),e.account?((0,l.wg)(),(0,l.iD)("div",T,(0,c.zw)(e.account),1)):(0,l.kq)("",!0)]),(0,l._)("div",X,[(0,l._)("div",ee,[ae,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.mobile},"input"]),modelValue:n.form.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>n.form.mobile=e),name:"mobile",type:"text",placeholder:"请输入手机号"},null,8,["class","modelValue"])]),e.mobile?((0,l.wg)(),(0,l.iD)("div",oe,(0,c.zw)(e.mobile),1)):(0,l.kq)("",!0)]),(0,l._)("div",le,[(0,l._)("div",ce,[ne,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.code},"input"]),modelValue:n.form.code,"onUpdate:modelValue":a[2]||(a[2]=e=>n.form.code=e),name:"code",type:"text",placeholder:"请输入验证码"},null,8,["class","modelValue"]),(0,l._)("span",{onClick:a[3]||(a[3]=e=>n.send()),class:"code"},(0,c.zw)(0===n.time?"发送验证码":`${n.time}秒后发送`),1)]),e.code?((0,l.wg)(),(0,l.iD)("div",se,(0,c.zw)(e.code),1)):(0,l.kq)("",!0)]),(0,l._)("div",te,[(0,l._)("div",ie,[re,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.password},"input"]),modelValue:n.form.password,"onUpdate:modelValue":a[4]||(a[4]=e=>n.form.password=e),name:"password",type:"password",placeholder:"请输入密码"},null,8,["class","modelValue"])]),e.password?((0,l.wg)(),(0,l.iD)("div",de,(0,c.zw)(e.password),1)):(0,l.kq)("",!0)]),(0,l._)("div",ue,[(0,l._)("div",me,[pe,(0,l.Wm)(i,{class:(0,c.C_)([{err:e.rePassword},"input"]),modelValue:n.form.rePassword,"onUpdate:modelValue":a[5]||(a[5]=e=>n.form.rePassword=e),name:"rePassword",type:"password",placeholder:"请确认密码"},null,8,["class","modelValue"])]),e.rePassword?((0,l.wg)(),(0,l.iD)("div",ve,(0,c.zw)(e.rePassword),1)):(0,l.kq)("",!0)]),(0,l._)("a",{onClick:a[6]||(a[6]=e=>n.submit()),href:"javascript:;",class:"submit"},"立即提交")])),_:1},8,["validation-schema"])}var _e={name:"CallbackPatch",components:{Form:A.l0,Field:A.gN},props:{unionId:{type:String,default:""}},setup(e){const a=(0,w.qj)({account:null,mobile:null,code:null,password:null,rePassword:null}),o={account:L.Z.accountApi,mobile:L.Z.mobile,code:L.Z.code,password:L.Z.password,rePassword:L.Z.rePassword},c=(0,w.iH)(null),n=(0,w.iH)(0),{pause:s,resume:t}=(0,S.Zv)((()=>{n.value--,n.value<=0&&s()}),1e3,!1);(0,l.Ah)((()=>{s()}));const i=async()=>{const e=o.mobile(a.mobile);!0===e?0===n.value&&(await(0,Q.bp)(a.mobile),(0,B.Z)({type:"success",text:"发送成功"}),n.value=60,t()):c.value.setFieldError("mobile",e)},r=(0,R.oR)(),d=(0,E.tv)(),u=async()=>{const o=c.value.validate();o&&(0,Q.lj)({unionId:e.unionId,...a}).then((e=>{const{id:a,account:o,avatar:l,mobile:c,nickname:n,token:s}=e.result;r.commit("user/setUser",{id:a,account:o,avatar:l,mobile:c,nickname:n,token:s}),r.dispatch("cart/mergeLocalCart").then((()=>{(0,B.Z)({type:"success",text:"完善信息成功"}),d.push(r.state.user.redirectUrl||"/")}))})).catch((e=>{(0,B.Z)({type:"error",text:"完善信息失败"})}))};return{form:a,mySchema:o,formCom:c,time:n,send:i,submit:u}}};const ke=(0,$.Z)(_e,[["render",fe],["__scopeId","data-v-23310c97"]]);var be=ke,he={name:"PageCallback",components:{LoginHeader:g.Z,LoginFooter:y.Z,CallbackBind:M,CallbackPatch:be},setup(){const e=(0,w.iH)(!0),a=(0,w.iH)(null),o=(0,w.iH)(null),l=(0,w.iH)(!0),c=(0,R.oR)(),n=(0,E.tv)(),s=(0,w.iH)(null);return z().Login.check()&&z().Login.getMe((e=>{s.value=e,(0,Q.K9)(e).then((a=>{console.log("openId",e);const{id:o,account:l,mobile:s,nickname:t,token:i}=a.result;c.commit("user/setUser",{id:o,account:l,mobile:s,nickname:t,token:i}),c.dispatch("cart/mergeLocalCart").then((()=>{n.push(c.state.user.redirectUrl),(0,B.Z)({type:"success",text:"QQ登录成功"})}))})).catch((e=>{l.value=!1}))})),{hasAccount:e,nickname:a,avatar:o,isBind:l,unionId:s}}};const we=(0,$.Z)(he,[["render",h],["__scopeId","data-v-5d051116"]]);var ge=we}}]);
//# sourceMappingURL=176.76d901f1.js.map